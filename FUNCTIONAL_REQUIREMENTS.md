# 機能要件一覧 - ReBASE 369 予約システム

## 🎯 システム概要

**システム目的**: 淡路Reベース369（廃校活用宿泊施設）の予約台帳管理 + 見積自動生成システム

**解決課題**:
1. 13部屋の稼働状況をカレンダーで一元管理し、空室確認を瞬時に行う
2. 複雑な料金体系（シーズン×曜日×年齢区分×オプション）を自動計算し、Board APIで見積データ同期

---

## 📋 コア機能要件

### 🗓 1. 予約台帳管理機能

#### 1.1 カレンダー表示機能
- [ ] 13部屋の稼働状況表示
  - [ ] 月次表示モード
  - [ ] 週次表示モード  
  - [ ] 日次表示モード
  - [ ] 表示切替UI制御
- [ ] 予約ブロック表示
  - [ ] 宿泊期間の視覚的表示
  - [ ] ゲスト名表示
  - [ ] 予約ステータス表示（確定/仮予約/キャンセル）
- [ ] 空室識別機能
  - [ ] 空室期間の色分け表示
  - [ ] 利用可能期間のハイライト表示
- [ ] 稼働率表示機能
  - [ ] 部屋別稼働率計算・表示
  - [ ] 期間別稼働率計算・表示
  - [ ] 全体稼働率表示
  - [ ] フロア別稼働率表示（2F/3F）

#### 1.2 部屋管理機能
- [ ] 13部屋マスタデータ管理
  - [ ] 2F 5部屋データ（1年1組/1年2組/2年1組/2年2組/作法室）
  - [ ] 3F 8部屋データ（3年1組/3年2組/3年3組/理科室/図書室/視聴覚室/被服室）
  - [ ] 各部屋の定員設定（5/10/21/25/35名）
  - [ ] 部屋タイプ分類（大部屋/中部屋/個室）
  - [ ] 室料設定（20,000円/13,000円/8,000円/7,000円/6,000円/5,000円）
  - [ ] フロア別表示切替機能

#### 1.3 空室検索機能
- [ ] 検索条件設定
  - [ ] 期間検索（開始日・終了日）
  - [ ] 人数検索（総人数・年齢区分別）
  - [ ] 部屋タイプ検索
  - [ ] オプション条件検索
- [ ] 即座確認機能
  - [ ] リアルタイム空室状況表示
  - [ ] 検索結果の即座更新
- [ ] 代替提案機能
  - [ ] 近接日程の提案
  - [ ] 類似条件での提案
  - [ ] 部屋組み合わせ提案

#### 1.4 予約重複防止機能
- [ ] ダブルブッキング防止
  - [ ] 同一部屋・期間の排他制御
  - [ ] リアルタイム重複チェック
  - [ ] 予約確定時の最終確認
- [ ] 整合性チェック
  - [ ] 人数と定員の自動チェック
  - [ ] 部屋組み合わせの妥当性チェック
- [ ] リアルタイム更新
  - [ ] 複数ユーザー同時アクセス対応
  - [ ] 予約状況の即座反映
  - [ ] 競合状態の検知・回避

### 💰 2. 見積自動生成機能

#### 2.1 料金計算エンジン
- [ ] 基本計算式実装：`総額 = 室料 + 個人料金 + オプション料金`（税込み）

#### 2.2 室料計算機能
- [ ] 部屋タイプ別単価計算
  - [ ] 大部屋料金計算
    - [ ] 2F作法室（25名）: 20,000円/部屋/泊
    - [ ] 3F被服室（35名）: 20,000円/部屋/泊
  - [ ] 中部屋料金計算
    - [ ] 3F視聴覚室（21名）: 13,000円/部屋/泊
    - [ ] 3F図書室（10名）: 8,000円/部屋/泊
  - [ ] 個室料金計算
    - [ ] 2F 1年1組（5名）: 7,000円/部屋/泊
    - [ ] 2F 1年2組（5名）: 7,000円/部屋/泊
    - [ ] 3F理科室（10名）: 6,000円/部屋/泊
    - [ ] 2F 2年1組（5名）: 5,000円/部屋/泊
    - [ ] 2F 2年2組（5名）: 5,000円/部屋/泊
    - [ ] 3F 3年1組（5名）: 5,000円/部屋/泊
    - [ ] 3F 3年2組（5名）: 5,000円/部屋/泊
    - [ ] 3F 3年3組（5名）: 5,000円/部屋/泊
- [ ] 利用部屋数×宿泊日数計算

#### 2.3 個人料金計算機能
- [ ] 年齢区分別単価設定
  - [ ] 大部屋・中部屋利用時料金
    - [ ] 大人: 4,800円/人/泊
    - [ ] 中高大学生: 4,000円/人/泊
    - [ ] 小学生: 3,200円/人/泊
    - [ ] 未就学児(3歳～): 2,500円/人/泊
    - [ ] 乳幼児(0～2歳): 0円（無料）
  - [ ] 個室利用時料金
    - [ ] 大人: 8,500円/人/泊
    - [ ] 大人合宿付添: 6,800円/人/泊
    - [ ] 中高大学生: 5,900円/人/泊
    - [ ] 小学生: 5,000円/人/泊
    - [ ] 未就学児(3歳～): 4,200円/人/泊
    - [ ] 乳幼児(0～2歳): 0円（無料）
- [ ] 曜日係数計算
  - [ ] 平日（月～木）: 1.0倍
  - [ ] 休日（金土日祝）: 1.22倍（約22%割増）
- [ ] シーズン係数計算
  - [ ] 通常期: 1.0倍
  - [ ] 繁忙期（3月/4月/5月GW/7月/8月/9月/12月）: 1.15倍（15%割増）
- [ ] 複合計算実装: 基本単価 × 曜日係数 × シーズン係数

#### 2.4 オプション料金計算機能
- [ ] 食事オプション計算（年齢区分別）
  - [ ] 朝食料金: 大人700円、中高大700円、小学生700円、未就学児700円
  - [ ] 夕食料金: 大人1,500円、中高大1,000円、小学生800円
  - [ ] BBQ料金: 大人3,000円、中高大2,200円、小学生1,500円
- [ ] 施設利用オプション計算
  - [ ] 会議室料金計算
    - [ ] 個人料金: 200円～600円/人/日
    - [ ] 室料: 平日1,000円、休日1,500円/時間
    - [ ] エアコン代: 500円/時間
  - [ ] 体育館料金計算
    - [ ] 個人料金: 500円/人/日
    - [ ] 室料: 平日2,000円、休日2,500円/時間
    - [ ] エアコン代: 1,500円/時間
- [ ] 備品オプション計算
  - [ ] プロジェクター: 3,000円/台/泊

#### 2.5 リアルタイム料金表示機能
- [ ] 即座再計算機能
  - [ ] 条件変更時の自動再計算
  - [ ] 人数変更時の即座更新
  - [ ] 日程変更時の料金再計算
- [ ] 明細表示機能
  - [ ] 室料詳細内訳表示
  - [ ] 個人料金詳細内訳表示
  - [ ] オプション料金詳細内訳表示
  - [ ] 税込み総額表示
- [ ] 日別明細機能
  - [ ] 宿泊期間中の日別料金内訳
  - [ ] 曜日別料金変動表示
  - [ ] シーズン別料金変動表示
- [ ] 複数パターン比較機能
  - [ ] 異なる条件での料金比較
  - [ ] 最適化提案表示

#### 2.6 見積書生成・管理機能
- [ ] Board案件連携機能
  - [ ] 既存Board案件への見積データ同期
  - [ ] 案件選択インターフェース
- [ ] バージョン管理機能
  - [ ] 見積変更履歴管理
  - [ ] 見積比較機能
- [ ] 外部連携機能
  - [ ] Board書類編集ページへの遷移
  - [ ] 外部リンクボタン実装

### 🔄 3. Board API連携機能

#### 3.1 Board案件管理機能
- [ ] 案件一覧同期機能
  - [ ] Board側で作成済み案件の取得
  - [ ] 案件一覧の表示
  - [ ] 定期同期機能（1日1回）
- [ ] 案件選択機能
  - [ ] 予約に該当するBoard案件の選択
  - [ ] 案件選択インターフェース
  - [ ] 案件検索・フィルター機能
- [ ] 案件情報表示機能
  - [ ] 顧客名表示
  - [ ] 案件番号表示
  - [ ] ステータス表示
  - [ ] 金額表示

#### 3.2 見積データ同期機能
- [ ] 明細データ送信機能
  - [ ] 予約システムで計算した料金明細をBoard見積書へPOST
  - [ ] API認証・接続機能
- [ ] 項目マッピング機能
  - [ ] 室料→Board明細項目への変換
  - [ ] 個人料金→Board明細項目への変換
  - [ ] オプション→Board明細項目への変換
- [ ] 差分更新機能
  - [ ] 予約変更時の見積データ自動更新
  - [ ] 変更検知機能
- [ ] 同期履歴管理機能
  - [ ] 同期ログ記録
  - [ ] エラー履歴管理
  - [ ] リトライ機能

#### 3.3 Board連携UI機能
- [ ] 案件選択画面
  - [ ] 該当案件の検索機能
  - [ ] 案件選択インターフェース
  - [ ] クライアント名でのフィルター
  - [ ] 案件番号でのフィルター
  - [ ] 日付範囲でのフィルター
- [ ] 同期状況表示機能
  - [ ] 最終同期日時表示
  - [ ] 同期ステータス表示
  - [ ] エラー状況表示
  - [ ] 同期進行状況表示
- [ ] 外部リンク機能
  - [ ] Board該当案件の書類編集ページへの直接遷移ボタン
  - [ ] 新しいタブでの外部リンク開放

---

## 🎨 UI/UX機能要件

### 4. 予約作成ウィザード機能

#### 4.1 5ステップウィザード構成
- [ ] Step 1: 日程選択
  - [ ] 開始日・終了日選択（DatePicker）
  - [ ] リアルタイム空室チェック
  - [ ] 期間妥当性チェック
- [ ] Step 2: 人数入力
  - [ ] 年齢区分別人数入力
    - [ ] 大人人数入力
    - [ ] 中高大学生人数入力
    - [ ] 小学生人数入力
    - [ ] 未就学児人数入力
    - [ ] 乳幼児人数入力
  - [ ] 総人数自動計算
  - [ ] 人数妥当性チェック
- [ ] Step 3: 部屋選択
  - [ ] 利用可能部屋一覧表示
  - [ ] 定員チェック機能
  - [ ] 部屋組み合わせ提案
  - [ ] 最適化提案表示
- [ ] Step 4: オプション選択
  - [ ] 食事オプション選択
  - [ ] 施設利用オプション選択
  - [ ] 備品オプション選択
  - [ ] オプション料金リアルタイム計算
- [ ] Step 5: 確認・Board案件連携
  - [ ] 予約内容確認表示
  - [ ] 料金明細確認
  - [ ] Board案件選択
  - [ ] 最終確認・予約確定

#### 4.2 ウィザード共通機能
- [ ] プログレス表示機能
  - [ ] 現在ステップ表示
  - [ ] 進行状況バー
  - [ ] ステップ名表示
- [ ] ナビゲーション機能
  - [ ] 次へボタン
  - [ ] 戻るボタン
  - [ ] ステップジャンプ機能
- [ ] バリデーション機能
  - [ ] 入力値検証
  - [ ] エラーメッセージ表示
  - [ ] 必須項目チェック
- [ ] レスポンシブデザイン
  - [ ] モバイル対応
  - [ ] タブレット対応
  - [ ] デスクトップ対応

### 5. ダッシュボード機能

#### 5.1 稼働率サマリー機能
- [ ] 稼働率カード表示
  - [ ] 今日の稼働率
  - [ ] 今週の稼働率
  - [ ] 今月の稼働率
- [ ] 売上チャート機能
  - [ ] 日別売上表示
  - [ ] 週別売上表示
  - [ ] 月別売上表示
  - [ ] チャートインタラクション機能

#### 5.2 予約状況表示機能
- [ ] 今日の予約一覧
  - [ ] チェックイン予約表示
  - [ ] チェックアウト予約表示
  - [ ] ゲスト詳細表示
- [ ] 部屋状況グリッド
  - [ ] 各部屋の現在稼働状況表示
  - [ ] 部屋別ステータス表示

#### 5.3 アラート・通知機能
- [ ] Board同期ステータスアラート
  - [ ] 同期成功通知
  - [ ] 同期エラー通知
  - [ ] 同期待機通知
- [ ] クイックアクション機能
  - [ ] 新規予約ボタン
  - [ ] カレンダー表示ボタン
  - [ ] 管理画面遷移ボタン

### 6. 管理画面機能

#### 6.1 部屋管理機能
- [ ] 部屋一覧表示
  - [ ] 13部屋の全データ表示
  - [ ] 定員・料金・設備情報表示
  - [ ] フロア別フィルター機能
- [ ] 部屋編集機能
  - [ ] 部屋情報編集フォーム
  - [ ] 料金設定変更
  - [ ] 設備情報更新
  - [ ] 有効/無効切替

#### 6.2 料金管理機能
- [ ] シーズン別料金設定
  - [ ] 繁忙期料金設定
  - [ ] 通常期料金設定
  - [ ] 料金係数設定
- [ ] 年齢区分別料金設定
  - [ ] 各年齢区分の基本料金設定
  - [ ] 大部屋・個室別料金設定
- [ ] 料金マトリクス表示
  - [ ] 全料金パターンの一覧表示
  - [ ] 料金シミュレーション機能

#### 6.3 オプション管理機能
- [ ] オプションカテゴリ管理
  - [ ] 食事オプション管理
  - [ ] 施設利用オプション管理
  - [ ] 備品オプション管理
- [ ] オプション料金設定
  - [ ] 年齢区分別料金設定
  - [ ] 曜日別料金設定
  - [ ] 施設別料金設定

#### 6.4 データ管理機能
- [ ] インポート/エクスポート機能
  - [ ] CSVインポート機能
  - [ ] CSVエクスポート機能
  - [ ] データバックアップ機能
- [ ] 一括操作機能
  - [ ] 一括有効/無効切替
  - [ ] 一括料金更新
  - [ ] 一括削除機能

---

## 🔐 認証・セキュリティ機能要件

### 7. 認証機能

#### 7.1 ユーザー認証機能
- [ ] ログイン機能
  - [ ] メール+パスワード認証
  - [ ] ログイン状態保持
  - [ ] 自動ログアウト機能
- [ ] アカウント管理機能
  - [ ] サインアップ機能
  - [ ] パスワードリセット機能
  - [ ] プロフィール管理機能

#### 7.2 権限管理機能
- [ ] 管理者権限機能
  - [ ] 管理者のみアクセス可能機能
  - [ ] 権限チェック機能
  - [ ] アクセス制御機能
- [ ] セッション管理機能
  - [ ] セッション有効期限管理
  - [ ] セッション更新機能
  - [ ] 不正アクセス検知

---

## 📊 データ管理・API機能要件

### 8. データベース機能

#### 8.1 予約データ管理機能
- [ ] projects テーブル機能
  - [ ] 予約メインデータ管理
  - [ ] ステータス管理（draft/confirmed/cancelled）
  - [ ] 宿泊情報管理
  - [ ] 人数情報管理
  - [ ] 顧客情報管理
  - [ ] 金額情報管理
- [ ] project_rooms テーブル機能
  - [ ] 部屋割り当て管理
  - [ ] 稼働状況管理
  - [ ] 重複予約防止機能
- [ ] project_items テーブル機能
  - [ ] 明細管理（オプション・個人料金）
  - [ ] 料金計算詳細管理

#### 8.2 マスタデータ管理機能
- [ ] rooms テーブル機能
  - [ ] 13部屋マスタデータ
  - [ ] 部屋情報管理
  - [ ] 料金設定管理
- [ ] seasons テーブル機能
  - [ ] シーズン設定管理
  - [ ] 料金係数管理
- [ ] rates テーブル機能
  - [ ] 料金マトリクス管理
  - [ ] 年齢区分別料金管理
- [ ] add_ons テーブル機能
  - [ ] オプション・サービス管理
  - [ ] カテゴリ別料金管理

#### 8.3 Board連携データ管理機能
- [ ] board_projects テーブル機能
  - [ ] Board案件キャッシュ機能
  - [ ] 定期同期機能
- [ ] board_sync_log テーブル機能
  - [ ] Board同期履歴管理
  - [ ] エラーログ管理

### 9. API機能

#### 9.1 内部API機能
- [ ] 予約API機能
  - [ ] 予約作成API
  - [ ] 予約更新API
  - [ ] 予約削除API
  - [ ] 予約一覧取得API
- [ ] 部屋API機能
  - [ ] 部屋一覧取得API
  - [ ] 空室検索API
  - [ ] 稼働率計算API
- [ ] 料金計算API機能
  - [ ] 料金計算API
  - [ ] 料金シミュレーションAPI

#### 9.2 外部API連携機能
- [ ] Board API連携機能
  - [ ] Board案件一覧取得API
  - [ ] Board見積更新API
  - [ ] Board案件詳細取得API
  - [ ] Board書類編集URL生成API

---

## 🚀 パフォーマンス・技術機能要件

### 10. パフォーマンス機能

#### 10.1 高速化機能
- [ ] キャッシュ機能
  - [ ] データキャッシュ機能
  - [ ] 計算結果キャッシュ機能
  - [ ] 画面表示キャッシュ機能
- [ ] 最適化機能
  - [ ] データベースクエリ最適化
  - [ ] インデックス最適化
  - [ ] 画像最適化

#### 10.2 リアルタイム機能
- [ ] リアルタイム更新機能
  - [ ] 予約状況リアルタイム更新
  - [ ] 料金計算リアルタイム更新
  - [ ] 空室状況リアルタイム更新
- [ ] 同時アクセス対応機能
  - [ ] 競合状態検知機能
  - [ ] 排他制御機能

### 11. エラーハンドリング・バリデーション機能

#### 11.1 エラーハンドリング機能
- [ ] エラー境界機能
  - [ ] アプリケーションエラー捕捉
  - [ ] エラー表示機能
  - [ ] エラー復旧機能
- [ ] API エラーハンドリング機能
  - [ ] 通信エラー処理
  - [ ] タイムアウト処理
  - [ ] リトライ機能

#### 11.2 データバリデーション機能
- [ ] 入力値検証機能
  - [ ] 必須項目チェック
  - [ ] 型チェック機能
  - [ ] 範囲チェック機能
- [ ] ビジネスロジック検証機能
  - [ ] 日程妥当性チェック
  - [ ] 人数妥当性チェック
  - [ ] 料金計算妥当性チェック

### 12. テスト・品質保証機能

#### 12.1 自動テスト機能
- [ ] ユニットテスト機能
  - [ ] 料金計算テスト
  - [ ] データ処理テスト
  - [ ] API テスト
- [ ] 統合テスト機能
  - [ ] エンドツーエンドテスト
  - [ ] API 統合テスト
  - [ ] データベース統合テスト

#### 12.2 品質チェック機能
- [ ] コード品質チェック機能
  - [ ] ESLint チェック
  - [ ] TypeScript 型チェック
  - [ ] コードフォーマットチェック
- [ ] パフォーマンステスト機能
  - [ ] 読み込み速度テスト
  - [ ] レスポンシブテスト
  - [ ] アクセシビリティテスト

---

## 📱 レスポンシブ・アクセシビリティ機能要件

### 13. レスポンシブデザイン機能

#### 13.1 デバイス対応機能
- [ ] モバイル対応機能
  - [ ] スマートフォン表示最適化
  - [ ] タッチ操作対応
  - [ ] モバイルナビゲーション
- [ ] タブレット対応機能
  - [ ] タブレット表示最適化
  - [ ] タッチ・マウス両対応
- [ ] デスクトップ対応機能
  - [ ] 大画面表示最適化
  - [ ] キーボードナビゲーション

#### 13.2 アクセシビリティ機能
- [ ] キーボードナビゲーション機能
  - [ ] Tab キーナビゲーション
  - [ ] Enter キー操作対応
  - [ ] Escape キー操作対応
- [ ] スクリーンリーダー対応機能
  - [ ] ARIA属性設定
  - [ ] セマンティックHTML
  - [ ] 代替テキスト設定
- [ ] カラーアクセシビリティ機能
  - [ ] コントラスト比確保
  - [ ] 色覚多様性対応
  - [ ] ダークモード対応

---

## 🔧 運用・保守機能要件

### 14. ログ・監視機能

#### 14.1 ログ機能
- [ ] システムログ機能
  - [ ] アクセスログ
  - [ ] エラーログ
  - [ ] パフォーマンスログ
- [ ] ビジネスログ機能
  - [ ] 予約操作ログ
  - [ ] 料金計算ログ
  - [ ] Board同期ログ

#### 14.2 監視機能
- [ ] システム監視機能
  - [ ] サーバー稼働監視
  - [ ] データベース監視
  - [ ] API 監視
- [ ] ビジネス監視機能
  - [ ] 予約状況監視
  - [ ] 売上監視
  - [ ] 同期状況監視

### 15. バックアップ・復旧機能

#### 15.1 データバックアップ機能
- [ ] 定期バックアップ機能
  - [ ] 日次バックアップ
  - [ ] 週次バックアップ
  - [ ] 月次バックアップ
- [ ] 手動バックアップ機能
  - [ ] オンデマンドバックアップ
  - [ ] 選択的バックアップ

#### 15.2 災害復旧機能
- [ ] データ復旧機能
  - [ ] ポイントインタイム復旧
  - [ ] 選択的復旧
- [ ] システム復旧機能
  - [ ] 高可用性構成
  - [ ] フェイルオーバー機能

---

## 📈 レポート・分析機能要件

### 16. 売上分析機能

#### 16.1 売上レポート機能
- [ ] 期間別売上レポート
  - [ ] 日別売上レポート
  - [ ] 週別売上レポート
  - [ ] 月別売上レポート
  - [ ] 年別売上レポート
- [ ] 部屋別売上レポート
  - [ ] 部屋別収益分析
  - [ ] 部屋タイプ別分析
  - [ ] フロア別分析

#### 16.2 稼働分析機能
- [ ] 稼働率レポート機能
  - [ ] 期間別稼働率
  - [ ] 部屋別稼働率
  - [ ] 曜日別稼働率
  - [ ] シーズン別稼働率
- [ ] 予約パターン分析機能
  - [ ] 予約傾向分析
  - [ ] 人数分布分析
  - [ ] リードタイム分析

### 17. エクスポート・共有機能

#### 17.1 データエクスポート機能
- [ ] CSV エクスポート機能
  - [ ] 予約データエクスポート
  - [ ] 売上データエクスポート
  - [ ] 稼働データエクスポート
- [ ] PDF エクスポート機能
  - [ ] レポートPDF生成
  - [ ] 見積書PDF生成

#### 17.2 外部連携機能
- [ ] Board データ連携機能
  - [ ] 自動データ同期
  - [ ] 手動データ同期
  - [ ] 同期ステータス管理
- [ ] 会計システム連携機能
  - [ ] 売上データ連携
  - [ ] 請求データ連携

---

## 🎯 完成基準

### 全機能実装完了の定義
- [ ] 上記全チェック項目の完了
- [ ] 全自動テストの成功
- [ ] パフォーマンステストの合格
- [ ] アクセシビリティテストの合格
- [ ] ユーザビリティテストの合格
- [ ] セキュリティテストの合格

### 品質基準
- [ ] コードカバレッジ 90% 以上
- [ ] ページ読み込み速度 3秒以内
- [ ] Lighthouse スコア 90 以上
- [ ] WCAG 2.1 AA 準拠
- [ ] セキュリティスキャン合格

### 運用準備完了基準
- [ ] 本番環境構築完了
- [ ] データ移行完了
- [ ] ユーザートレーニング完了
- [ ] 運用手順書作成完了
- [ ] 緊急時対応手順作成完了

---

**総チェック項目数**: 384項目
**実装完成度目標**: 100%
**品質基準**: エンタープライズレベル
**運用開始目標**: 全項目完了後